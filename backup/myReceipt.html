<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="./style/myReceipt.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style/index.css" />
    <link rel="stylesheet" href="./style/ctsp.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Đơn Hàng Của Tôi</title>
</head>

<body>
    <header>
        <div class="header-main">
            <div class="container">
                <div class="inner-wrap">
                    <div class="hamburger" id="hamburger">
                        <div><i class="fa-solid fa-bars"></i></div>
                    </div>
                </div>
                <div class="inner-menu" id="menu">
                    <ul>
                        <li class="thuonghieu">
                            <i class="fa-solid fa-house"></i>
                            <a href="./index_user.html">Trang chủ</a>
                        </li>
                        <li class="loaibut">
                            <i class="fa-solid fa-pen"></i>
                            <a href="#">Loại bút</a>
                            <div class="box-submenu">
                                <ul class="loaibut-list">
                                    <li>
                                        <div>Bút------------ html</div>
                                    </li>
                                    <li>
                                        <div>Bút bi</div>
                                    </li>
                                    <li>
                                        <div>Bút dạ bi</div>
                                    </li>
                                    <li>
                                        <div>Bút dạ kim</div>
                                    </li>
                                    <li>
                                        <div>Bút máy</div>
                                    </li>
                                    <li>
                                        <div>Bút chì</div>
                                    </li>
                                    <li>
                                        <div>Bút hàng độc</div>
                                    </li>
                                    <li>
                                        <div>Bút viết chữ đẹp</div>
                                    </li>
                                </ul>
                            </div>
                        </li>
                        <li>
                            <i class="fa-solid fa-person-chalkboard"></i>
                            <a href="#" class="huong_dan_mua_hang">Hướng dẫn mua hàng</a>
                        </li>

                        <li>
                            <i class="fa-solid fa-phone"></i>
                            <a href="#">Liên hệ</a>
                        </li>
                        <li>
                            <i class="fa-solid fa-receipt"></i>
                            <a href="./myReceipt.html" id="myReceipt">
                                Đơn Hàng Của Tôi
                            </a>
                        </li>
                        <div class="cart-icon" id="xem_gio_hang">
                            <i class="fa-solid fa-cart-shopping"></i>Giỏ hàng
                        </div>
                        <li>
                            <div class="sear2">
                                <div class="search" id="search">
                                    <input type="text" id="searchInput" placeholder="Tìm kiếm sản phẩm..." />
                                    <button id="searchButton">
                                        <i class="fa-solid fa-magnifying-glass"></i>
                                    </button>
                                </div>
                                <select id="filter">
                                    <option value="mac-dinh">Mặc định</option>
                                    <option value="gia-thap-den-cao">Gía thấp đến cao</option>
                                    <option value="gia-cao-den-thap">Gía cao đến thấp</option>
                                    <option value="giam-gia-nhieu">Giảm giá nhiều</option>
                                </select>
                                <div class="tim_gia" style="display: none">
                                    <input type="text" placeholder="Giá min" id="searchPriceMin" />
                                    <input type="text" placeholder="Giá max" id="searchPriceMax" />
                                    <button id="searchButtonPrice">
                                        <i class="fa-solid fa-magnifying-glass"></i>
                                    </button>
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="layout-defauft_account">
                                <div id="greeting" style="display: none">Xin chào, <span id="userNameDisplay"></span>!
                                </div>
                                <div id="btnLogout" style="display: none; text-decoration: none">
                                    <button class="log_out">Đăng xuất</button>
                                </div>

                        </li>

                    </ul>
                </div>
            </div>
    </header>
    <main>
        <h1 id="title-name">ĐƠN HÀNG CỦA BẠN</h1>
        <table class="receipt-table" cellspacing="0" cellpadding="50%" align="center" style="width: 50%;">
            <thead>
                <tr>
                    <th>Số Thứ Tự</th>
                    <th>Tên Sản Phẩm</th>
                    <th>Ảnh</th>
                    <th>Giá</th>
                    <th>Số Lượng</th>
                </tr>
            </thead>
            <tbody class="product_content" align="center">
            </tbody>
        </table>
        <div class="sum_container">
            <p id="money_sum" style="color: white;"></p>
        </div>
        <!--div cho phân trang-->
        <div class="pagination" align="center">
            <button id="firstPage">Đầu</button>
            <button id="prevPage" disabled>Trước</button>
            <span id="pageNumbers"></span>
            <button id="nextPage">Sau</button>
            <button id="lastPage">Cuối</button>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-container">
            <div class="footer-contact">
                <h3>Liên hệ với chúng tôi</h3>
                <ul>
                    <li><i class="fa-solid fa-phone"></i> Điện thoại: +84 123 456 789</li>
                    <li><i class="fa-solid fa-envelope"></i> Email: nguyendinhhungtc2020@gmail.com</li>
                    <li><i class="fa-solid fa-map-marker-alt"></i> Địa chỉ: Đại học Sài Gòn, quận 5, đường An Dương
                        Vương</li>
                </ul>
            </div>
            <div class="footer-hours">
                <h3>Giờ làm việc</h3>
                <ul>
                    <li><i class="fa-solid fa-clock"></i> Thứ 2 - Thứ 6: 8:00 - 18:00</li>
                    <li><i class="fa-solid fa-clock"></i> Thứ 7: 9:00 - 17:00</li>
                    <li><i class="fa-solid fa-clock"></i> Chủ nhật: Nghỉ</li>
                </ul>
            </div>
            <div class="footer-social">
                <h3>Kết nối với chúng tôi</h3>
                <div class="social-icons">
                    <a href="https://www.facebook.com/"><i class="fa-brands fa-facebook"></i></a>
                    <a href="#"><i class="fa-brands fa-instagram"></i></a>
                    <a href="#"><i class="fa-brands fa-twitter"></i></a>
                    <a href="#"><i class="fa-brands fa-youtube"></i></a>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Bán Bút | Thiết kế bởi Nguyễn Đình Hùng</p>
        </div>
    </footer>
    <div class="overlay" id="overlay"></div>
    <script src="user/controller/drawProducts.js" type="module"></script>
    <script src="user/controller/renderLoaibutList.js" type="module"></script>
    <script src="user/controller/gioHang.js" type="module"></script>
    <script src="user/controller/logout.js" type="module"></script>
    <script src="user/controller/cartGui.js" type="module"></script>
    <script src="user/GUI/huongdanmuahang.js" type="module"></script>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const userName = localStorage.getItem("loggedInUserName");
            if (userName) {
                document.getElementById("greeting").style.display = "block";
                document.getElementById("userNameDisplay").textContent = userName;
                document.getElementById("btnLogout").style.display = "block";
            } else {
                document.getElementById("btnLogin").style.display = "block";
                document.getElementById("btnLogout").style.display = "none";
                document.getElementById("greeting").style.display = "none";
            }

            // Mở/đóng menu
            document.getElementById('hamburger').addEventListener('click', function () {
                var menu = document.querySelector('.inner-menu');
                var overlay = document.getElementById('overlay'); // Thêm dòng này
                menu.classList.toggle('show');
                overlay.style.display = menu.classList.contains('show') ? 'block' : 'none'; // Hiện/ẩn overlay
            });

            // Đóng menu khi nhấp ra ngoài
            document.addEventListener('click', function (event) {
                const menu = document.querySelector('.inner-menu');
                const hamburger = document.getElementById('hamburger');
                const overlay = document.getElementById('overlay'); // Thêm dòng này
                if (!menu.contains(event.target) && !hamburger.contains(event.target)) {
                    menu.classList.remove('show');
                    overlay.style.display = 'none'; // Ẩn overlay
                }
            });
        });

        document.getElementById("chotdon").addEventListener("click", function (e) {
            e.preventDefault();
            window.location.href = "./Payment.html";
        });
        function toggleSearchDisplay() {
            const searchElement = document.querySelector('.sear2');
            if (window.innerWidth < 768) {
                searchElement.style.display = 'none'; // Ẩn khi trên màn hình điện thoại
            } else {
                searchElement.style.display = 'block'; // Hiện khi trên màn hình lớn
            }
        }

        // Kiểm tra kích thước khi trang được tải
        document.addEventListener("DOMContentLoaded", toggleSearchDisplay);
        // Kiểm tra kích thước khi trang được tải
        document.addEventListener("DOMContentLoaded", toggleSearchDisplay);
        document.querySelectorAll('.inner-menu a').forEach(item => {
            item.addEventListener('click', function () {
                var menu = document.querySelector('.inner-menu');
                var overlay = document.getElementById('overlay');
                menu.classList.remove('show');
                overlay.style.display = 'none';
            });
        });
    </script>
</body>
<script>
    let currentPage = 1;
    const itemsPerPage = 3;
    const productData = JSON.parse(localStorage.getItem(localStorage.getItem("loggedInUserEmail")));
    const productContent = document.querySelector(".product_content");
    const pageNumbers = document.getElementById("pageNumbers");
    const sumMoney = document.getElementById("money_sum");

    let sum = productData.reduce((acc, item) => acc + parseFloat(item.giaSanPham), 0);
    sumMoney.textContent = "Tổng số tiền: " + sum + " VND";

    // tính tổng số trang(tối đa 4)
    const totalPages = Math.min(4, Math.ceil(productData.length / itemsPerPage));

    // hàm hiện sản phẩm ở trang hiện tại
    function displayProducts(page) {
        // giữ vị trí kéo chuột trước khi chuyển sang trang mới
        const scrollPosition = window.scrollY;

        productContent.innerHTML = "";
        const start = (page - 1) * itemsPerPage;
        const end = Math.min(start + itemsPerPage, productData.length);

        for (let i = start; i < end; i++) {
            const newRow = document.createElement("tr");

            const productId = document.createElement("td");
            const productName = document.createElement("td");
            const productImg = document.createElement("td");
            const productPrice = document.createElement("td");
            const productAmount = document.createElement("td");
            const imgDisplay = document.createElement("img");

            productId.textContent = i + 1;
            productName.textContent = productData[i].tenSanPham;
            imgDisplay.src = productData[i].imgSanPham;
            imgDisplay.style.width = "100px";
            productImg.appendChild(imgDisplay);
            productPrice.textContent = productData[i].giaSanPham + " VND";
            productAmount.textContent = productData[i].soLuongSanPham;

            newRow.appendChild(productId);
            newRow.appendChild(productName);
            newRow.appendChild(productImg);
            newRow.appendChild(productPrice);
            newRow.appendChild(productAmount);

            productContent.appendChild(newRow);
        }
        window.scrollTo(0, scrollPosition);
    }

    // hàm tạo nút chuyển trang
    function updatePageButtons() {
        pageNumbers.innerHTML = "";
        for (let i = 1; i <= totalPages; i++) {
            const pageButton = document.createElement("button");
            pageButton.textContent = i;
            pageButton.disabled = i === currentPage;
            pageButton.addEventListener("click", () => {
                currentPage = i;
                displayProducts(currentPage);
                updatePageButtons();
                updateNavButtons();
            });
            pageNumbers.appendChild(pageButton);
        }
    }

    // hàm cập nhật nút trang
    function updateNavButtons() {
        document.getElementById("prevPage").disabled = currentPage === 1;
        document.getElementById("nextPage").disabled = currentPage === totalPages;
        document.getElementById("firstPage").disabled = currentPage === 1;
        document.getElementById("lastPage").disabled = currentPage === totalPages;
    }

    // Event listener cho nút trang
    document.getElementById("prevPage").addEventListener("click", () => {
        if (currentPage > 1) {
            currentPage--;
            displayProducts(currentPage);
            updatePageButtons();
            updateNavButtons();
        }
    });

    document.getElementById("nextPage").addEventListener("click", () => {
        if (currentPage < totalPages) {
            currentPage++;
            displayProducts(currentPage);
            updatePageButtons();
            updateNavButtons();
        }
    });

    // Event listeners cho hai nút đầu và cuối trang
    document.getElementById("firstPage").addEventListener("click", () => {
        currentPage = 1;
        displayProducts(currentPage);
        updatePageButtons();
        updateNavButtons();
    });

    document.getElementById("lastPage").addEventListener("click", () => {
        currentPage = totalPages;
        displayProducts(currentPage);
        updatePageButtons();
        updateNavButtons();
    });

    // setup 
    displayProducts(currentPage);
    updatePageButtons();
    updateNavButtons();

</script>

</html>