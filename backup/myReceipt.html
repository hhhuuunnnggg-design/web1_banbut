<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style/myReceipt.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đơn Hàng Của Tôi</title>
</head>

<body>
    <h1 id="title-name">ĐƠN HÀNG CỦA BẠN</h1>
    <!--div cho phân trang-->
    <div class="pagination" align="center">
        <button id="firstPage">Đầu</button>
        <button id="prevPage" disabled>Trước</button>
        <span id="pageNumbers"></span>
        <button id="nextPage">Sau</button>
        <button id="lastPage">Cuối</button>
    </div>

    <table class="receipt-table" cellspacing="0" cellpadding="50%" align="center" style="width: 50%;">
        <thead>
            <tr>
                <th>Số Thứ Tự</th>
                <th>Tên Sản Phẩm</th>
                <th>Ảnh</th>
                <th>Giá</th>
                <th>Số Lượng</th>
            </tr>
        </thead>
        <tbody class="product_content" align="center">
        </tbody>
    </table>
    <div class="sum_container">
        <p id="money_sum" style="color: white;"></p>
    </div>
</body>
<script>
    let currentPage = 1;
    const itemsPerPage = 3;
    const productData = JSON.parse(localStorage.getItem(localStorage.getItem("loggedInUserEmail")));
    const productContent = document.querySelector(".product_content");
    const pageNumbers = document.getElementById("pageNumbers");
    const sumMoney = document.getElementById("money_sum");

    let sum = productData.reduce((acc, item) => acc + parseFloat(item.giaSanPham), 0);
    sumMoney.textContent = "Tổng số tiền: " + sum + " VND";

    // tính tổng số trang(tối đa 4)
    const totalPages = Math.min(4, Math.ceil(productData.length / itemsPerPage));

    // hàm hiện sản phẩm ở trang hiện tại
    function displayProducts(page) {
        // giữ vị trí kéo chuột trước khi chuyển sang trang mới
        const scrollPosition = window.scrollY;

        productContent.innerHTML = "";
        const start = (page - 1) * itemsPerPage;
        const end = Math.min(start + itemsPerPage, productData.length);

        for (let i = start; i < end; i++) {
            const newRow = document.createElement("tr");

            const productId = document.createElement("td");
            const productName = document.createElement("td");
            const productImg = document.createElement("td");
            const productPrice = document.createElement("td");
            const productAmount = document.createElement("td");
            const imgDisplay = document.createElement("img");

            productId.textContent = i + 1;
            productName.textContent = productData[i].tenSanPham;
            imgDisplay.src = productData[i].imgSanPham;
            imgDisplay.style.width = "100px";
            productImg.appendChild(imgDisplay);
            productPrice.textContent = productData[i].giaSanPham + " VND";
            productAmount.textContent = productData[i].soLuongSanPham;

            newRow.appendChild(productId);
            newRow.appendChild(productName);
            newRow.appendChild(productImg);
            newRow.appendChild(productPrice);
            newRow.appendChild(productAmount);

            productContent.appendChild(newRow);
        }
        window.scrollTo(0, scrollPosition);
    }

    // hàm tạo nút chuyển trang
    function updatePageButtons() {
        pageNumbers.innerHTML = "";
        for (let i = 1; i <= totalPages; i++) {
            const pageButton = document.createElement("button");
            pageButton.textContent = i;
            pageButton.disabled = i === currentPage;
            pageButton.addEventListener("click", () => {
                currentPage = i;
                displayProducts(currentPage);
                updatePageButtons();
                updateNavButtons();
            });
            pageNumbers.appendChild(pageButton);
        }
    }

    // hàm cập nhật nút trang
    function updateNavButtons() {
        document.getElementById("prevPage").disabled = currentPage === 1;
        document.getElementById("nextPage").disabled = currentPage === totalPages;
        document.getElementById("firstPage").disabled = currentPage === 1;
        document.getElementById("lastPage").disabled = currentPage === totalPages;
    }

    // Event listener cho nút trang
    document.getElementById("prevPage").addEventListener("click", () => {
        if (currentPage > 1) {
            currentPage--;
            displayProducts(currentPage);
            updatePageButtons();
            updateNavButtons();
        }
    });

    document.getElementById("nextPage").addEventListener("click", () => {
        if (currentPage < totalPages) {
            currentPage++;
            displayProducts(currentPage);
            updatePageButtons();
            updateNavButtons();
        }
    });

    // Event listeners cho hai nút đầu và cuối trang
    document.getElementById("firstPage").addEventListener("click", () => {
        currentPage = 1;
        displayProducts(currentPage);
        updatePageButtons();
        updateNavButtons();
    });

    document.getElementById("lastPage").addEventListener("click", () => {
        currentPage = totalPages;
        displayProducts(currentPage);
        updatePageButtons();
        updateNavButtons();
    });

    // setup 
    displayProducts(currentPage);
    updatePageButtons();
    updateNavButtons();

</script>

</html>